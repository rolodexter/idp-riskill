<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Updated path references to CSS files -->
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/styles-additions.css">
    <link rel="stylesheet" href="styles/styles-refined.css">
    <link rel="stylesheet" href="styles/styles-refined-layout.css">
    <link rel="stylesheet" href="../module-row-fix.css"> <!-- Still referencing original until migrated -->
    <link rel="stylesheet" href="../anomalies-widget.css"> <!-- Still referencing original until migrated -->
    <!-- Include the new project widget styles -->
    <link rel="stylesheet" href="components/projects/projects-widget.css">
    <title>Riskill Dashboard</title>
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <!-- Enhanced Anomalies Widget Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.9/dist/plot.umd.min.js"></script>
    <script>
        window.Plot = Plot;
    </script>
    <script src="https://unpkg.com/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.7/dist/tippy-bundle.umd.js"></script>
    <script>
        window.tippy = tippy;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script>
        window.Sortable = Sortable;
    </script>
    <script src="https://unpkg.com/@floating-ui/dom@1.5.1/dist/floating-ui.dom.umd.min.js"></script>
    <!-- Advanced data visualization styles -->
    <!-- Enhanced Typography with Professional Font Pairing -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Added ApexCharts for professional data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <div class="app-container">
        <!-- Top ERP-style menu with glassmorphism -->
        <nav class="top-menu">
            <button class="hamburger" id="hamburger-menu" aria-label="Open Menu">
                <span class="menu-line"></span>
                <span class="menu-line"></span>
                <span class="menu-line"></span>
            </button>
            <div class="menu-group">
                <div class="menu-item"><span>File</span></div>
                <div class="menu-item"><span>Edit</span></div>
                <div class="menu-item"><span>View</span></div>
                <div class="menu-item"><span>Agents</span></div>
                <div class="menu-item"><span>Data</span></div>
                <div class="menu-item"><span>Settings</span></div>
            </div>
            <div class="user-info">
                <span class="user-name">Matthias</span>
                <div class="user-avatar">M</div>
            </div>
        </nav>
        <div id="mobile-menu-overlay" class="mobile-menu-overlay">
            <div class="mobile-menu-content">
                <button class="close-mobile-menu" aria-label="Close Menu">&times;</button>
                <div class="mobile-menu-item">File</div>
                <div class="mobile-menu-item">Edit</div>
                <div class="mobile-menu-item">View</div>
                <div class="mobile-menu-item">Agents</div>
                <div class="mobile-menu-item">Data</div>
                <div class="mobile-menu-item">Settings</div>
            </div>
        </div>

        <!-- KPI Widget Row -->
        <section class="kpi-row">
            <!-- NEW Project Stratification Widget (replaces Mega-Project Performance Monitor) -->
            <div id="project-widget-container" class="kpi-widget enterprise-kpi"></div>

            <!-- Business Unit Revenue Comparison Widget -->
            <div class="kpi-widget business-units enterprise-kpi">
                <div class="indicator blue-pulse"></div>
                <div class="kpi-content">
                    <div class="kpi-header">
                        <div class="kpi-value">11T+</div>
                        <div class="benchmark top-quartile" title="P001 Business Unit">P001</div>
                    </div>
                    <div class="kpi-label">P001 Revenue (Pesos)</div>
                    <!-- Donut chart will be inserted here by refined-visualizations.js -->
                    <div class="chart-container" id="business-unit-chart"></div>
                    <div class="micro-trend sparkline" data-values="9.8,10.1,10.3,10.5,10.7,10.9,11.0" data-labels="Jun,Jul,Aug,Sep,Oct,Nov,Dec" data-color="#2B7FFF"></div>
                    <div class="data-context">
                        <span class="forecast-indicator positive" title="AI-driven forecast">3.2%</span>
                        <span class="data-freshness" title="Last updated">2h ago</span>
                    </div>
                </div>
                <div class="kpi-trend">
                    <span class="trend-arrow">↑</span>
                    <span class="trend-value">+1.2T</span>
                    <span class="trend-label">pesos</span>
                </div>
                <div class="kpi-actions">
                    <button class="view-report-button" title="View Business Unit Report">View Report</button>
                </div>
            </div>

            <!-- Customer Segment Analysis Widget -->
            <div class="kpi-widget customer-segments enterprise-kpi">
                <div class="indicator green-glow"></div>
                <div class="kpi-content">
                    <div class="kpi-header">
                        <div class="kpi-value">881</div>
                        <div class="benchmark top-quartile" title="Total Customer Count">Total</div>
                    </div>
                    <div class="kpi-label">Customer Segments</div>
                    <div class="kpi-trend">
                        <span class="trend-value">47%</span>
                        <span class="trend-label">Gov</span>
                    </div>
                    <div class="micro-trend sparkline" data-values="32,35,38,41,43,45,47" data-labels="Jun,Jul,Aug,Sep,Oct,Nov,Dec" data-color="#4CAF50"></div>
                    <div class="data-context">
                        <span class="forecast-indicator positive" title="AI-driven forecast">↗ 5.4%</span>
                        <span class="data-freshness" title="Last updated">4h ago</span>
                    </div>
                </div>
                <div class="kpi-actions">
                    <button class="view-report-button" title="View Customer Segments Report">View Report</button>
                </div>
            </div>

            <!-- International Supplier Network Widget -->
            <div class="kpi-widget supplier-network enterprise-kpi">
                <div class="indicator amber-fill"></div>
                <div class="kpi-content">
                    <div class="kpi-header">
                        <div class="kpi-value">43</div>
                        <div class="benchmark third-quartile" title="International Suppliers">Int'l</div>
                    </div>
                    <div class="kpi-label">Supplier Network</div>
                    <div class="kpi-trend">
                        <span class="trend-value">5</span>
                        <span class="trend-label">US suppliers</span>
                    </div>
                    <div class="micro-trend sparkline" data-values="38,39,40,41,42,42,43" data-labels="Jun,Jul,Aug,Sep,Oct,Nov,Dec" data-color="#FFC107"></div>
                    <div class="data-context">
                        <span class="forecast-indicator positive" title="AI-driven forecast">2.4%</span>
                        <span class="data-freshness" title="Last updated">4h ago</span>
                    </div>
                </div>
                <div class="kpi-actions">
                    <button class="view-report-button" title="View Supplier Network Report">View Report</button>
                </div>
            </div>
            
            <!-- Remaining widgets from original index.html -->
            <!-- ... -->
        </section>

        <!-- Include visualization scripts -->
        <script src="../data-visualizations.js"></script> <!-- Still referencing original until migrated -->
        <script src="../refined-visualizations.js"></script> <!-- Still referencing original until migrated -->
        <!-- Include our new projects widget script -->
        <script src="components/projects/projects-widget.js"></script>
        <script src="../scripts.js"></script> <!-- Still referencing original until migrated -->
        
        <!-- Initialize the projects widget -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize the new projects widget
                const projectWidget = new ProjectWidget('project-widget-container');
                
                // Initialize other visualizations (temporarily using original code)
                if (typeof initializeRefinedVisualizations === 'function') {
                    initializeRefinedVisualizations();
                }
            });
        </script>
    </div>
</body>
</html>
